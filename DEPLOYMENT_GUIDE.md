# 배포 가이드 및 고려사항

## 🚨 배포 시 발생할 수 있는 문제점

### 1. **SQLite 데이터베이스 파일 경로**
- 현재: 프로젝트 루트에 `game_data.db` 파일로 저장
- 문제: 
  - 클라우드 서버의 경우 파일 시스템이 임시적일 수 있음 (예: Heroku, Vercel)
  - 서버 재시작 시 데이터 손실 가능
  - 여러 서버 인스턴스 간 데이터 공유 불가

### 2. **Socket.io 연결 URL**
- 현재: 클라이언트에서 `window.location.hostname`을 사용해 동적 감지
- 문제:
  - 배포 환경에서 프론트엔드와 백엔드가 다른 도메인/포트일 수 있음
  - 환경 변수(`VITE_SOCKET_URL`) 설정 필요

### 3. **CORS 설정**
- 현재: `origin: '*'` (모든 도메인 허용)
- 문제: 보안상 위험 (프로덕션에서는 특정 도메인만 허용해야 함)

### 4. **포트 하드코딩**
- 현재: 포트 3001, 5173이 코드에 하드코딩됨
- 문제: 배포 환경의 포트가 다를 수 있음

### 5. **인메모리 데이터 구조**
- 현재: `playersData`, `connectedPlayers`, `transactionLogs` 등이 메모리에만 저장
- 문제: 서버 재시작 시 모든 게임 상태 손실

## ✅ 로컬 사용의 장점

1. **간단한 설정**: 추가 설정 없이 바로 실행 가능
2. **데이터 안정성**: SQLite 파일이 로컬에 안전하게 저장
3. **빠른 개발**: 수정사항 즉시 반영
4. **네트워크 제어**: 같은 네트워크 내에서만 접근 가능 (보안)
5. **디버깅 용이**: 로그와 오류 추적이 쉬움

## 🌐 배포가 필요한 경우

다음과 같은 경우에만 배포를 고려하세요:
- 원격 참가자가 인터넷을 통해 접속해야 할 때
- 장기간 운영이 필요할 때
- 여러 관리자가 동시에 관리해야 할 때

## 🔧 배포 시 필요한 수정사항

### 1. 데이터베이스 마이그레이션
```javascript
// PostgreSQL, MySQL 등 영구 저장소로 변경 필요
// 또는 클라우드 SQLite 서비스 사용 (예: Turso)
```

### 2. 환경 변수 설정
```bash
# .env.production
VITE_SOCKET_URL=https://your-backend-domain.com
PORT=3001
NODE_ENV=production
```

### 3. CORS 설정 수정
```javascript
// server.js
cors: {
  origin: process.env.ALLOWED_ORIGINS?.split(',') || ['https://your-frontend-domain.com'],
  credentials: true,
}
```

### 4. 프로세스 관리자 사용
```bash
# PM2 사용 예시
pm2 start server.js --name "game-server"
pm2 save
pm2 startup
```

### 5. 리버스 프록시 설정 (Nginx)
```nginx
# Socket.io 연결을 위한 WebSocket 프록시 설정 필요
```

## 💡 권장사항

### 현재 상황에서는 **로컬 사용을 강력히 권장**합니다:

1. **같은 네트워크 내에서만 사용**
   - 로컬 네트워크 IP로 접속 (예: `http://192.168.0.74:5173`)
   - 모든 참가자가 같은 Wi-Fi/네트워크에 연결

2. **빌드 후 로컬 서버 실행**
   ```bash
   npm run build
   npm run server
   ```
   - `dist` 폴더의 정적 파일을 서버가 자동 제공
   - 프로덕션 빌드로 최적화된 성능

3. **데이터 백업**
   - `game_data.db` 파일을 정기적으로 백업
   - 게임 시작 전/후 백업 권장

## 🎯 결론

**로컬 사용이 가장 빠르고 안정적입니다.**

배포는 다음 경우에만 고려:
- 인터넷을 통한 원격 접속이 필수일 때
- 장기간 운영이 필요할 때
- 위의 수정사항을 모두 적용할 준비가 되었을 때

현재 코드는 로컬 네트워크 사용을 전제로 설계되어 있어, 배포 시 상당한 수정이 필요합니다.






